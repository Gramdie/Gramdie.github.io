<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postar Jogo | Gramdie</title>
    <link href="https://fonts.googleapis.com/css2?family=Inclusive+Sans&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #1C1C1C; --card: #262626; --blue: #1E90FF; --txt: #ffffff; }
        body { background: var(--bg); color: var(--txt); font-family: 'Inclusive Sans', sans-serif; display: flex; justify-content: center; padding: 40px; margin: 0; }
        
        .form-container { background: var(--card); padding: 40px; border-radius: 24px; width: 100%; max-width: 650px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { margin-top: 0; color: var(--blue); font-size: 28px; }
        p.subtitle { color: #888; margin-bottom: 30px; font-size: 14px; }
        
        .field-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: bold; color: var(--blue); }
        
        input, textarea { 
            width: 100%; padding: 14px; border-radius: 12px; 
            border: 1px solid #444; background: #111; color: white; box-sizing: border-box; 
            font-family: inherit; font-size: 15px; outline: none; transition: 0.3s;
        }
        input:focus, textarea:focus { border-color: var(--blue); box-shadow: 0 0 8px rgba(30, 144, 255, 0.3); }
        
        .btn-post { 
            background: var(--blue); color: white; border: none; padding: 20px; 
            width: 100%; border-radius: 15px; font-weight: bold; cursor: pointer; 
            margin-top: 20px; font-size: 18px; transition: 0.3s;
        }
        .btn-post:hover { filter: brightness(1.2); }
        .btn-post:disabled { background: #444; cursor: not-allowed; opacity: 0.6; }

        .status-msg { margin-top: 15px; text-align: center; font-size: 14px; display: none; }
    </style>
</head>
<body>

    <div class="form-container">
        <h2>Postar Jogo</h2>
        <p class="subtitle">O post será armazenado como um objeto JSON no repositório oficial.</p>
        
        <div class="field-group">
            <label>Banner do Jogo (URL da Imagem)</label>
            <input type="url" id="banner" placeholder="Ex: https://i.imgur.com/link.png" required>
        </div>

        <div class="field-group">
            <label>Título (Até 40 caracteres)</label>
            <input type="text" id="title" maxlength="40" placeholder="Nome do Jogo" required>
        </div>

        <div class="field-group">
            <label>Descrição (Até 1200 caracteres)</label>
            <textarea id="desc" rows="4" maxlength="1200" placeholder="Fale sobre o jogo, mecânicas, etc..."></textarea>
        </div>

        <div class="field-group">
            <label>Link de Download (Obrigatório)</label>
            <input type="url" id="mainLink" placeholder="Link do Mega, Drive, Mediafire..." required>
        </div>

        <div class="field-group">
            <label>Requisitos Mínimos (Opcional)</label>
            <textarea id="requirements" rows="3" placeholder="Processador, RAM, GPU..."></textarea>
        </div>

        <div class="field-group">
            <label>Nome do Autor</label>
            <input type="text" id="author" placeholder="Deixe vazio para Gerar Número Aleatório">
        </div>

        <button class="btn-post" id="btnSubmit">Publicar na Nuvem</button>
        <div id="status" class="status-msg"></div>
    </div>

    <script>
        /**
         * LÓGICA DE POSTAGEM VIA GITHUB API
         */
        const GITHUB_CONFIG = {
            owner: 'Gramdie',
            repo: 'Gramdie-repository-for-games',
            path: 'posts', // Pasta onde os JSONs serão salvos
            token: 'COLE_SEU_TOKEN_AQUI' // Precisa de um Personal Access Token com permissão 'repo'
        };

        const btn = document.getElementById('btnSubmit');
        const status = document.getElementById('status');

        btn.onclick = async () => {
            // 1. Coleta os dados através do DOM
            const title = document.getElementById('title').value.trim();
            const desc = document.getElementById('desc').value.trim();
            const banner = document.getElementById('banner').value.trim();
            const mainLink = document.getElementById('mainLink').value.trim();
            const reqs = document.getElementById('requirements').value.trim();
            const authorInput = document.getElementById('author').value.trim();

            // 2. Validação básica
            if (!title || !mainLink) {
                alert("Título e Link de Download são obrigatórios!");
                return;
            }

            // 3. Lógica de Anonimato (ID Aleatório)
            const author = authorInput || Math.floor(100000000 + Math.random() * 900000000).toString();

            // 4. Montagem do Objeto JSON (Meta Dados)
            const postData = {
                title: title,
                description: desc,
                banner: banner,
                mainLink: mainLink,
                requirements: reqs,
                author: author,
                date: new Date().toISOString()
            };

            // Interface
            btn.disabled = true;
            btn.innerText = "Processando Dados...";
            status.style.display = "block";
            status.innerText = "Verificando conexão com o repositório...";

            // 5. Preparação do Arquivo para o GitHub
            const fileName = `${Date.now()}_${title.toLowerCase().replace(/\s+/g, '_')}.json`;
            const contentBase64 = btoa(unescape(encodeURIComponent(JSON.stringify(postData, null, 2))));

            try {
                // Envio via API do GitHub (Método PUT para criar conteúdo)
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Add post: ${title}`,
                        content: contentBase64
                    })
                });

                if (response.ok) {
                    status.style.color = "#00FF00";
                    status.innerText = "Publicado com sucesso! Redirecionando...";
                    setTimeout(() => window.location.href = '../index.html', 2000);
                } else {
                    const error = await response.json();
                    throw new Error(error.message);
                }

            } catch (err) {
                console.error(err);
                status.style.color = "#FF4444";
                status.innerText = "Erro ao publicar. Verifique o seu Token do GitHub.";
                btn.disabled = false;
                btn.innerText = "Tentar Novamente";
            }
        };
    </script>
</body>
</html>
